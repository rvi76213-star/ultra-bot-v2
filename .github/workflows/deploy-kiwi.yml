name: Deploy for Kiwi Browser

on:
  workflow_dispatch:
    inputs:
      runtime:
        description: 'Runtime duration (minutes)'
        required: true
        default: '5'
        type: choice
        options:
        - '5'
        - '10'
        - '30'
        - '60'

jobs:
  deploy-kiwi:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        
    - name: Install dependencies
      run: npm install
      
    - name: Check appstate
      run: |
        if [ -f "src/secure/appstate.json" ]; then
          echo "âœ… appstate.json found - Ready for Kiwi Browser"
        else
          echo "âŒ appstate.json not found"
          echo "Please upload appstate.json to src/secure/"
          exit 1
        fi
        
    - name: Generate Kiwi setup script
      run: |
        cat > kiwi-setup.sh << 'EOF'
        #!/bin/bash
        echo "ðŸ¤– Kiwi Browser Setup for YOUR CRUSH Bot"
        echo "========================================"
        echo ""
        echo "Steps to run in Kiwi Browser:"
        echo "1. Open Kiwi Browser"
        echo "2. Go to GitHub repository"
        echo "3. Download all files"
        echo "4. Open Termux or similar terminal"
        echo "5. Run: chmod +x run.sh"
        echo "6. Run: ./run.sh"
        echo ""
        echo "Bot Features:"
        echo "âœ… appstate.json support"
        echo "âœ… Kiwi Browser compatible"
        echo "âœ… Fun commands (chor, murgi, abal, etc.)"
        echo "âœ… Owner/Admin/User system"
        echo ""
        echo "Owner: RANA (MASTER ðŸª“)"
        echo "Email: ranaeditz333@gmail.com"
        EOF
        
        chmod +x kiwi-setup.sh
        echo "âœ… Kiwi setup script created"
        
    - name: Run bot for speci fied time
      run: |
        RUNTIME=${{ github.event.inputs.runtime }}
        echo "â° Running bot for $RUNTIME minutes..."
        
        # Convert minutes to seconds
        SECONDS=$((RUNTIME * 60))
        
        # Start bot
        npm start &
        BOT_PID=$!
        
        echo "Bot PID: $BOT_PID"
        echo "Running for $RUNTIME minutes ($SECONDS seconds)"
        
        # Wait for specified time
        sleep $SECONDS
        
        # Stop bot
        kill $BOT_PID 2>/dev/null || true
        echo "âœ… Bot stopped after $RUNTIME minutes"
        
    - name: Upload Kiwi setup guide
      uses: actions/upload-artifact@v4
      with:
        name: kiwi-guide
        path: |
          kiwi-setup.sh
          README.md
        retention-days: 7
