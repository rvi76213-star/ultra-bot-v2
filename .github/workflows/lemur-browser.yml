name: Deploy for Lemur Browser

on:
  workflow_dispatch:
    inputs:
      runtime:
        description: 'Runtime duration (minutes)'
        required: true
        default: '5'
        type: choice
        options:
          - '5'
          - '10'
          - '30'
          - '60'

jobs:
  deploy-lemur:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: Install dependencies
      run: npm install
      
    - name: Check appstate
      id: check-appstate
      run: |
        if [ -f "src/secure/appstate.json" ]; then
          echo "âœ… appstate.json found"
          echo "exists=true" >> $GITHUB_OUTPUT
        else
          echo "âŒ appstate.json not found"
          echo "exists=false" >> $GITHUB_OUTPUT
        fi
        
    - name: Create Lemur files
      run: |
        echo "ðŸ“± Creating Lemur Browser files..."
        
        # Create Lemur guide
        cat > LEMUR_README.md << 'EOF'
        # Lemur Browser Setup Guide
        
        ## Steps:
        1. Download files in Lemur Browser
        2. Install Termux from Play Store
        3. Run in Termux:
           ```bash
           pkg install nodejs
           cd /storage/emulated/0/Download/
           npm install
           npm run login
           npm start
           ```
        
        ## Bot Commands:
        !help - Show help
        !info - Bot info
        !startfun chor - Start fun
        !stopfun - Stop fun
        
        ## Developer:
        RANA (MASTER ðŸª“)
        ranaeditz333@gmail.com
        EOF
        
        echo "âœ… Lemur files created"
        
    - name: Run bot
      if: steps.check-appstate.outputs.exists == 'true'
      run: |
        RUNTIME=${{ github.event.inputs.runtime }}
        SECONDS=$((RUNTIME * 60))
        
        echo "ðŸš€ Starting bot for $RUNTIME minutes..."
        
        npm start &
        BOT_PID=$!
        echo $BOT_PID > bot.pid
        
        sleep 30
        
        echo "â° Running for $RUNTIME minutes..."
        sleep $SECONDS
        
        echo "ðŸ›‘ Stopping bot..."
        kill $(cat bot.pid) 2>/dev/null || true
        rm -f bot.pid
        
    - name: Upload Lemur files
      uses: actions/upload-artifact@v4
      with:
        name: lemur-files
        path: |
          LEMUR_README.md
        retention-days: 30
